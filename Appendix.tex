%!TEX root = article.tex

\section{Appendix}
\label{s:Appendix}

Additional material such as extra figures.

\subsection{Additional Material for the Green's Function Method}
%Put all the extra plots etc. from Green's Function Code here.

\subsubsection{General Structure of the Used Code}
\label{GreensCode}
%Explain everything about the code

In this section, an insight to the code provided by Secomb et al. \cite{Secomb2004} will be given. Especially a description about what data this code uses and what data it computes will follow.. 
The main goal is to understand what the results are and where they really come from. For this, a general explanation of the structure and organization of the code and the methods behind the computations will given.

\subsubsection*{Inputs}
\label{Inputs}
%What data this code actually needs and what this data is
%What are the inputs for this code ? Where do they come from ?

In general, the Green's function method code takes .dat-files as inputs, which basically contain the network files and the parameters for the diffusion and oxygen transport inside the vessels.
\\
\\The input data in form of .dat-files consists of four files:\\
\\- The SoluteParams.dat-file: This file contains all the information about the solutes we are looking at. In our case, this is simply oxygen. The specific informations are things like the tissue solubility, the Michaelis constant of consumption, etc.\\
\\- The Network.dat-file: This file contains all the information about the network we are looking at. This information is basically in form of an array. This array defines for each segment the type of vessel, the start point, the end point, the diameter (in microns), the relativ flow and the hematocrit level of the blood inside the given vessel.\\
\\- The IntravascRes.dat-file: This file contains all the information about the diameter on which the sources are computed around the vessel centerline. The second important information given here is the intravascular resistance to radial oxygen transport $K$ for each diameter and vessel.\\
\\- The ContourParams.dat-file: This file contains all the information necessary to create the contour-plots. This means that we create a plot, where the oxygen concentration inside a three dimensional domain can be visualized on a two dimensional projection. In this file, the projection plane can be specified, and the focus geometry inside the three dimensional space can be selected.
\\
\\The part of the code where the read-in of the network data and the specific transport parameters through the input files is being done is the input.cpp code.
\\
\\The analyzenet.cpp-part of the code analyzes the input-files and gives each vessel and node a number. Through this, the oxygen concentration can be computed for each node of the three dimensional space. The output after this step can be seen in Figure \ref{fig:NetNodesSegs_Glom}, but it is important to note that usually in the next step, the oxygen gradients are computed, and the segmentation numbers are replaced by the specific oxygen levels for each node and vessel.

\subsubsection*{Outputs}
\label{Outputs}
%What this code actually produces
%What are the outputs for this code ? How are they produced ? Where do they come from ?

The Green's function method code gives .dat-files and images (contour.ps-files) as outputs, which basically contain the results that have been discussed previously in the Results \ref{Results} chapter.
\\
\\The contour.ps-files are produced by the contour.cpp-part of the code, which basically generates and writes the data for the contour-plots. This data is a plot of the vessel from bottom to top according to the z-coordinate. In other words, this is a two dimensional projection of the computed oxygen fields in a three dimensional space. One could see this plot as a 2D picture of a 3D network, giving some information about the general oxygen fields everywhere in the segment. There is an option of computing the transport of different solutes in the network, in which case a new pages is generated for each solute, and the computed solute concentration for each area is shown in colors. In our case, the only used solute is oxygen and thus only one contour-plot is shown for each network.
\\
\\The code responsible for the creation of the NetNodesSegs.ps and the NedNodesOxygen.ps-files is picturenetwork.cpp. Here, the network and the computed oxygen fields of the network are projected on a z = 0 plane. For this, the parameters from the CountourParams.dat file are used. Finally, a postscript file called NetNodesSegs is produced, in which nodes are labeled with nodvar and segments with segvar. A second file called NetNodesOxygen is produced, in which the computed oxygen level for each node is pictured.
\\
\\The general outputs of the code can be classified into two categories:\\
\\- The first category is in the form of PostScript-files that can be visualized. These outputs are basically pictures showing the computed oxygen concentrations. The three files are the ones that were previously mentioned: the Contour.ps-file, the NedNodesSegs.ps-file and finally the NedNodesOxygen.ps-file.\\
\\- The second category is in the form text-files, containing the computed data in arrays. These values are the computed oxygen partial pressures for each node in the tissue, and represent the oxygen field output for a three-dimensional segment.
\\

\subsubsection*{Organization of the Code}
%Briefly talk about each part of the code and explain how it all works together
%Might keep this part more general and mention each of the parts of the code like a puzzle in the Appendix

The code provided by Secomb et al. \cite{Secomb2004} consists of a few .cpp-files, so that tasks like input read-ins, calculations and output-file generations are separated. Each file has a specific role, which will be explained in detail in this section. As one can think, the most important part of this code is the implementation of the Green's function method and its application to the given data.
\\
%Solver bicgstab
\\The bicgstab.cpp-part of the code is the implementation of a solver based on the Parameter-free iterative linear solver by R. Weiss \cite{weiss1996parameter}.
\\
%blood
\\The blood.cpp-part of the code is quite interesting, as it basically does an important part of the calculation to obtain the oxygen concentration and distribution in the vessels and the tissue. In this part of the code
\\
%contr-lines
\\The contr-lines.cpp-part of the code generates the contour lines for these plots, whereas the contr-shade.cpp-part of the code generates the colors and the color bar on the side of the generated picture/plot.
\\
%convect
\\The convect.cpp-part of the code does the convective (flow) part of the calculation.
\\
%eval
\\The eval.cpp-part of the code does the evaluation of the solute field depending on the source strengths provided.
\\
%numerical methods (gaussj and ludcmp)
\\There are some numerical methods and mathematical calculations behind the simulation, as for example the Gauss-Jordan elimination or the Lower-Upper decomposition, which is implemented in the gaussj.cpp-part and the ludcmp.cpp-part of the code.
\\
%greens
\\The main implementation of the Green's Function Method is in the greens.cpp-part of the code, where Green's Function approach for multiple reacting species is implemented. (Talk more about this, heart of the code)
\\
%histogram
\\Histograms of solute levels are evaluated in the histogram.cpp-part of the code.
\\
%initgreens
\\Initial tissue source strengths (given uniform solute field) are computed in the initgreens.cpp-part of the code.
\\
%main
\\The code main.cpp calls the greens.cpp-code.
\\
%nrutil (.cpp and .hh)
\\The code nrutil.cpp/nrutil.hh is declaring variables and is allocating them.
\\
%outboun (method?)
\\Outboun.cpp: method = 1: finds the smallest convex region inside the cuboid
which excludes tissue node points that have a distance to the nearest
vessel greater than a value specified by the user (lb).  Any point
outside a region between two planes containing the required points is
excluded.  This is repeated for multiple plane orientations, determined by am.
\\
\\method = 2: finds all tissue points within a distance lb of the vessels, but
does not make a convex region.  Fills in 'holes' in interior, whether 2D or 3D.
\\
\\Output:	nnt, total tissue node points inside the region.
nbou > 1 if inside region, value gives tissue point index
\\
%putrank
\\putrank.cpp: generate nodes in order of flow direction
\\
%readsources
\\readsources.cpp: read source strengths from file (from TissueSources.out and VesselSources.out)
\\
%setuparrays 0, 1, 2
\\setuparrays0.cpp: set up arrays with fixed dimensions (for Green's)
\\
\\setuparrays1.cpp: set up arrays with dimensions of nnod and nseg (for Green's)
\\
\\setuparrays2.cpp: set up arrays with dimensions of nnv and nnt (for Green's)
\\
%testconvect
\\testconvect.cpp: testing if convect is giving correct results for alpha (?) matrix. Comparing matrix values with values obtained by numerical differentiation.
\\
%tissrate
\\tissrate.cpp: computing tissue uptake rates of solutes as a function of solute levels (concentration)
\\
\\Everyone of these code-parts is using the nrutil.hh code, why ?

\subsubsection{Some More Green's Results}

\begin{figure}[h]
\centering
\includegraphics[width=100mm]{NetNodesSegs_Glom}
\caption{\footnotesize Green's Net Nodes Output for a Glomerulus Network}
\label{fig:NetNodesSegs_Glom}
\end{figure}

\subsection{Additional Material for DuMuX}
%Put all the extra images from ParaView here.

%\newpage
%\subsubsection{Some Glomerulus Network Simulation Results}
%Just to have some more figures

%\begin{figure}[h]
%\centering
%\includegraphics[width=162mm]{glom_velocity}
%\caption{Velocity Field in a Glomerulus}
%\label{fig:glom_velocity}
%\end{figure}
%The figure \ref{fig:glom_velocity} is the result of a DuMuX 1p-1p blood flow simulation computed on a glomerulus network. The velocity field of the flow is visualized.\\

%\begin{figure}[h]
%\centering
%\includegraphics[width=162mm]{glom2_velocity}
%\caption{Velocity Field in a Glomerulus}
%\label{fig:glom2_velocity}
%\end{figure}
%The figure \ref{fig:glom2_velocity} is the result of a DuMuX 1p-1p blood flow simulation computed on a glomerulus network. The velocity field of the flow is visualized.\\

\subsubsection*{The 1p-1p-tracer-tracer Code}
\begin{figure}[h]
\centering
\includegraphics[width=350mm]{1p_1p_tracer_tracer_1}
\caption{\footnotesize The 1p-1p-tracer-tracer Code (1)}
\label{fig:1p-1p-tracer-tracer-1}
\end{figure}
\begin{figure}[h]
\centering
\includegraphics[width=350mm]{1p_1p_tracer_tracer_2}
\caption{\footnotesize The 1p-1p-tracer-tracer Code (2)}
\label{fig:1p-1p-tracer-tracer-2}
\end{figure}
\begin{figure}[h]
\centering
\includegraphics[width=350mm]{1p_1p_tracer_tracer_3}
\caption{\footnotesize The 1p-1p-tracer-tracer Code (3)}
\label{fig:1p-1p-tracer-tracer-3}
\end{figure}
\begin{figure}[h]
\centering
\includegraphics[width=350mm]{1p_1p_tracer_tracer_4}
\caption{\footnotesize The 1p-1p-tracer-tracer Code (4)}
\label{fig:1p-1p-tracer-tracer-4}
\end{figure}


\subsubsection*{Some Tracer Simulations}
\label{Tracer}

This simulation is a simple diffusion of Groundwater in a porous rock. The velocity field of the solute is assumed to be constant.
\begin{figure}[h]
\centering
\includegraphics[width=162mm]{tracer_1}
\caption{\footnotesize $DuMu^x$ Tracer Concentration Simulation for a Rectangular Geometry (Time Step 1)}
\label{fig:tracer_1}
\end{figure}
Figure \ref{fig:tracer_1} is the result of a $DuMu^x$ tracer simulation computed on a rectangular geometry. The solute field in the network for the first time step is visualized.\\
\begin{figure}[h]
\centering
\includegraphics[width=162mm]{tracer_2}
\caption{\footnotesize $DuMu^x$ Tracer Concentration Simulation for a Rectangular Geometry (Time Step 10)}
\label{fig:tracer_2}
\end{figure}
Figure \ref{fig:tracer_2} is the solute field for the same simulation for the last time step is visualized.\\
\begin{figure}[h]
\centering
\includegraphics[width=162mm]{tracer_velocity}
\caption{\footnotesize $DuMu^x$ Tracer Velocity Simulation for a Rectangular Geometry}
\label{fig:tracer_velocity}
\end{figure}
Figure \ref{fig:tracer_velocity} is the constant velocity field of the solute.\\